<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Juego Arcade</title>
    <link rel="icon" href="../../favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../css/styles.css" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
</head>
<body>
   <canvas id="myCanvas" width="480" height="320"></canvas>

<script>
    var canvas=document.getElementById("myCanvas");//guardamos una referencia al elemento canvas en la variable canvas.
    var ctx = canvas.getContext("2d");/*creamos la variable ctx para guardar el contexto de gráficos 2D, que es la herramienta que usamos xa                                         dibujar.*/
    var ballRadius=10;////variable que mantendrá el radio del círculo dibujado y se utilizará para los cálculos


    var x=canvas.width/2;
    var y=canvas.height-30;

    //añadir un valor pequeño a x e y después de que cada fotograma se haya dibujado para que parezca que la pelota se está moviendo
    var dx=2;
    var dy=-2;

    var paddleHeight=10;
    var paddleWidth=75;

    var paddleX=(canvas.width-paddleWidth)/2;//la posición en el eje X en la que empieza a dibujarse
    var rightPressed= false;//guarda informacion sobre si se ha pulsado el boton derecho, en false xq al ppio no se han pulsado
    var leftPressed=false;

     /*variabkes de los ladrillos*/
    var brickRowCount = 3;
    var brickColumnCount = 5;
    var brickWidth = 75;
    var brickHeight = 20;
    var brickPadding = 10;
    var brickOffsetTop = 30;
    var brickOffsetLeft = 30;
    document.addEventListener("keydown",keyDownHandler,false);
    document.addEventListener("keyup",keyUpHandler,false);

    //pasará por las filas y las columnas y creará los ladrillos. bricks[0][0] es el primer ladrillo (columna 0, fila 0) y se dibujará en "x" 0 e //"y" 0.Seguiremos recorriendo bricks hasta llegar a bricks 2,4, que es el último ladrillo.
    var bricks = [];
    for(c=0; c<brickColumnCount; c++) {
        bricks[c] = [];
        for(r=0; r<brickRowCount; r++) {
             bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
    }

    function keyDownHandler(e){
        if(e.keyCode==39){

            rightPressed=true;

            }
            else if(e.keyCode==37){

            leftPressed=true;

            }

        }

    function keyUpHandler(e){

        if(e.keyCode==39){

            rightPressed=false;
        }
        else if(e.keyCode==37){

            leftPressed=false;

            }
        }

    function drawBall(){
        ctx.beginPath();
        ctx.arc(x,y,ballRadius,0,2*Math.PI);
        ctx.fillstyle="#0033FF";
        ctx.fillStroke="#0033FF";
        ctx.Stroke="10"
        ctx.fill();
        ctx.closePath();
        }

    function drawPaddle(){
        ctx.beginPath();
        ctx.rect(paddleX,canvas.height-paddleHeight,paddleWidth,paddleHeight);
        ctx.fillstyle="#0095DD";
        ctx.fill();
        ctx.closePath();
        }
    function drawBricks() {
        for(c=0; c<brickColumnCount; c++) {
            for(r=0; r<brickRowCount; r++) {
                if(bricks[c][r].status == 1) {
                    var brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft;
                    var brickY = (r*(brickHeight+brickPadding))+brickOffsetTop;
                    bricks[c][r].x = brickX;
                    bricks[c][r].y = brickY;
                    ctx.beginPath();
                    ctx.rect(brickX, brickY, brickWidth, brickHeight);
                    ctx.fillStyle = "#0095DD";
                    ctx.fill();
                    ctx.closePath();
                }
            }
        }
    }

    function collisionDetection() {
        for(c=0; c<brickColumnCount; c++) {
            for(r=0; r<brickRowCount; r++) {
                var b = bricks[c][r];
                if(b.status == 1) {
                    if(x > b.x && x < b.x+brickWidth && y > b.y && y < b.y+brickHeight) {
                        dy = -dy;
                        b.status = 0;
                    }
                }
            }
        }
    }


    function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        drawBricks();
        drawBall();
        drawPaddle();
        collisionDetection();
     if(x + dx > canvas.width-ballRadius || x + dx < ballRadius) {
            dx = -dx;
        }
        if(y + dy < ballRadius) {
            dy = -dy;
        }
        else if(y + dy > canvas.height-ballRadius) {
            if(x > paddleX && x < paddleX + paddleWidth) {
                 if(y= y-paddleHeight){
                dy = -dy  ;
                 }
            }
            else {
                alert("GAME OVER");
                document.location.reload();
            }
        }
        if(rightPressed && paddleX<canvas.width-paddleWidth){

            paddleX+=7;
            }
         else if(leftPressed && paddleX>0 ){
             paddleX-=7;

             }

             x=x+dx;
             y=y+dy;
        }

    setInterval(draw,10);

</script>
</body>
</html>
